---
import "../main.css";
import type { CollectionEntry } from "astro:content";
import Head from "../components/Head.astro";
import Body from "../components/Body.astro";
import { isUrl, formatPathOrUrl } from "../utilities";

type schema = CollectionEntry<"articles">["data"];

interface Props extends schema {
    body: string;
}

const { title, date, cover_image, body } = Astro.props;

const description = body.replace(/[\r\n\t\f\v ]+/g, " ").substring(0, 247) + "...";

const url = Astro.url.href;

let imageUrl;

if (isUrl(cover_image)) {
    imageUrl = cover_image;
} else {
    imageUrl = formatPathOrUrl(Astro.url.origin, cover_image);
}

// const imageUrl = `${Astro.url.origin}${cover_image}`;
---

<!doctype html>
<html lang="id">
    <Head>
        <title>{title}</title>
        <meta property="og:title" content={title} data-pagefind-meta="title[content]" />
        <meta property="og:description" content={description} />
        <meta property="og:type" content="article" />
        <meta property="og:url" content={url} />
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:image" content={imageUrl} data-pagefind-meta="image[content]" />
        <meta name="theme-color" content={"#0f172a"} data-react-helmet="true" />
        <meta
            property="article:published_time"
            content={date.toISOString()}
            data-pagefind-meta="published_time[content]"
        />
    </Head>
    <Body>
        <slot />
    </Body>
</html>
